#!/usr/bin/env zsh
# vim: set ft=sh:
#
# This is generated by "aws-vault-generate.sh"
#
set -e

BIN="${AWS_PACKER_BIN_OVERRIDE:-packer}"

[[ -e "/opt/homebrew/bin" ]] && HOMEBREW_PREFIX="/opt/homebrew" || HOMEBREW_PREFIX="/usr/local"

if [[ -n $AWS_VAULT ]] || [[ -n $VIMRUNTIME ]]; then
  exec "$HOMEBREW_PREFIX/bin/$BIN" "$@"
fi

# If AWS_PROFILE is empty or "localstack" or we want to use localstack via --profile=localstack use the original aws binary
if [[ -z "${AWS_PROFILE}" ]] || [[ "$*" == *"localstack"* ]] || [[ "${AWS_PROFILE}" == "localstack" ]]; then
  exec "$HOMEBREW_PREFIX/bin/$BIN" "$@"
fi

exec aws-vault exec --duration 1h "$AWS_PROFILE" -- "$HOMEBREW_PREFIX/bin/$BIN" "$@"
